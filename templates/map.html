<!DOCTYPE html>
<html lang="ja">

  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>çµ±åˆãƒãƒƒãƒ—</title>
    <!-- Leaflet CSS -->
    <link
      rel="stylesheet"
      href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" />
    <!-- Bootstrap CSS -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
      rel="stylesheet">
    <!-- Bootstrap Icons CSS -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css"
      rel="stylesheet">

    <style>
    body {
      margin: 0;
      font-family: Arial, sans-serif;
    }

    #map {
      width: 100vw;
      height: 100vh;
    }

    /* Leaflet ã®ã‚¿ã‚¤ãƒ«ç”»åƒå…¨ä½“ã«ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ã‚’ã‹ã‘ã‚‹ */
.leaflet-tile-pane img {
  /* å½©åº¦ï¼ˆsaturateï¼‰ã‚’ 1.5 å€ã€ã‚³ãƒ³ãƒˆãƒ©ã‚¹ãƒˆï¼ˆcontrastï¼‰ã‚’ 1.2 å€ã€æ˜åº¦ï¼ˆbrightnessï¼‰ã‚’ 1.1 å€ã« */
  filter: saturate(1.8) contrast(1.2) brightness(1.0);
}



    .menu-bar {
      position: fixed;
      width: 50%;
      bottom: 20px;
      left: 50%;
      transform: translateX(-50%);
      z-index: 1000;
    }

    .menu-bar button {
      flex-grow: 1;
    }

    .custom-icon {
  position: relative;
  /* ã“ã“ã§ stacking context ã‚’ä½œã£ã¦ãŠã */
  z-index: 1;
  width: 50px;
  height: 50px;
  background: rgb(14, 83, 12);
  border: 2px solid #ccc;
  border-radius: 50%;
  box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
  display: flex;
  align-items: center;
  justify-content: center;
}

.custom-icon::after {
  content: '';
  position: absolute;
  bottom: -11px;
  left: 50%;
  transform: translateX(-50%);
  width: 0;
  height: 0;
  border-left: 10px solid transparent;
  border-right: 10px solid transparent;
  border-top: 15px solid rgb(14, 83, 12);
  /* ã“ã“ã§ä¸¸ã®ä¸‹ã«å›ã‚Šè¾¼ã¾ã›ã‚‹ */
  z-index: -1;
}


    .icon-image {
      width: 90%;
      height: 90%;
      background-size: cover;
      background-position: center;
      border-radius: 50%;
      border: 1px solid #aaa;
    }

    .details-panel {
      position: fixed;
      top: 0;
      left: -400px;
      width: 400px;
      height: 100%;
      overflow-y: auto;
      transition: left 0.3s ease;
      z-index: 1001;
    }

    .details-panel.active {
      left: 0;
    }
  </style>
  </head>

  <body>
    <div id="map"></div>

    <!-- è©³ç´°ãƒ‘ãƒãƒ« -->
    <div id="details-panel" class="details-panel bg-white shadow p-3">
      <button class="btn-close float-end" onclick="hideDetails()"></button>
    </div>

    <!-- ãƒ¡ãƒ‹ãƒ¥ãƒ¼ãƒãƒ¼ -->
    <div
      class="menu-bar bg-white shadow rounded-pill p-2 d-flex gap-2 align-items-center">
      <button class="btn btn-light">ğŸ  ã™ã¹ã¦</button>
      <button class="btn btn-light">ğŸ” æ¤œç´¢</button>
      <button class="btn btn-light">ğŸ´ ã‚°ãƒ«ãƒ¡</button>
      <button class="btn btn-light">ğŸ›ï¸ ã‚·ãƒ§ãƒƒãƒ”ãƒ³ã‚°</button>
      <button class="btn btn-light">ğŸ“„ è©³ç´°æƒ…å ±</button>
    </div>

    <!-- Leaflet JS -->
    <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
    <!-- Bootstrap JS Bundle -->
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script>
    const map = L.map('map').setView([35.486417749642015, 139.3428098153942], 30);

    // OSM ã‚¿ã‚¤ãƒ«ï¼ˆæ¨™æº–åœ°å›³ï¼‰
 //L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
   //attribution: '&copy; OpenStreetMap contributors'
 ///}).addTo(map);
     // èˆªç©ºå†™çœŸã‚¿ã‚¤ãƒ«è¿½åŠ ï¼ˆEsri World Imageryï¼‰
 L.tileLayer(
   'https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}', {
     attribution:
       '&copy; <a href="https://www.esri.com/">Esri</a>, Maxar, Earthstar Geographics, and the GIS User Community',
     maxZoom: 18
   }
 ).addTo(map);

    // ã‚«ã‚¹ã‚¿ãƒ ã‚¢ã‚¤ã‚³ãƒ³ä½œæˆ
    const createCustomIcon = (imageUrl) => {
      return L.divIcon({
        className: '',
        html: `
          <div class="custom-icon">
            <div class="icon-image" style="background-image: url('${imageUrl}');"></div>
          </div>
        `,
        iconSize: [50, 60],
        iconAnchor: [25, 60]
      });
    };

    // ãƒ€ãƒŸãƒ¼ãƒ”ãƒ³è¿½åŠ 
    const markers = [
      { location: [35.48604116703019, 139.34128951057255], image: './static/sunset.jpg', name: 'K1å·é¤¨' },
      { location: [35.48650866834297, 139.34112683577234], image: './static/sunset.jpg', name: 'K2å·é¤¨' },
      { location: [35.48565158052546, 139.34141709865116], image: './static/sunset.jpg', name: 'K3å·é¤¨' },
      { location: [35.485683613095844, 139.3419922129912], image: './static/sunset.jpg', name: 'K4å·é¤¨' },
      { location: [35.485597402140684, 139.34321173217694], image: './static/sunset.jpg', name: 'KAITã‚¢ãƒªãƒ¼ãƒŠ' },
      { location: [35.4860692562503, 139.34187073632998], image: './static/sunset.jpg', name: 'å…ˆé€²ç ”' },
      { location: [35.48714378031437, 139.34102852276388], image: './static/sunset.jpg', name: 'ãƒã‚¤ã‚ª' },
      { location: [35.4876058212225, 139.34111663074825], image: './static/sunset.jpg', name: 'è‡ªå‹•è»Š' },
      { location: [35.48768007599212, 139.34208759034047], image: './static/sunset.jpg', name: 'ãƒ­ãƒœãƒƒãƒˆ' },
      { location: [35.48638279161658, 139.34182473387625], image: './static/sunset.jpg', name: 'åºƒå ´' },
      { location: [35.487920311541316, 139.3430478210974], image: './static/sunset.jpg', name: 'è‡ªå‹•è»Š' },
      { location: [35.4867846462545, 139.34246309957499], image: './static/sunset.jpg', name: 'å·¥æˆ¿' },
      { location: [35.486649238937936, 139.34321411804413], image: './static/sunset.jpg', name: 'åºƒå ´' },

    ];

    markers.forEach(markerData => {
      const marker = L.marker(markerData.location, {
        icon: createCustomIcon(markerData.image)
      }).addTo(map);

      marker.on('click', () => {
        showDetails({
          image: markerData.image,
          name: markerData.name,
          description: 'ã“ã“ã«ã€ã‚¹ãƒãƒƒãƒˆã®èª¬æ˜ãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã€‚Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua.',
          address: 'æ±äº¬éƒ½å“å·åŒºæ±å…«æ½®1',
          phone: '00-1234-5678'
        });
      });
    });

    // è©³ç´°ãƒ‘ãƒãƒ«è¡¨ç¤º
    function showDetails(content) {
      const detailsPanel = document.getElementById('details-panel');
      detailsPanel.innerHTML = `
        <button class="btn-close float-end" onclick="hideDetails()"></button>
        <img src="${content.image}" alt="${content.name}" class="img-fluid rounded mb-3">
        <h2 class="fs-4">${content.name}</h2>
        <div class="d-flex gap-2 mb-3">
          <button class="btn btn-outline-secondary">â¤ï¸ 4</button>
          <button class="btn btn-outline-secondary">ğŸ“¥ ä¿å­˜</button>
          <button class="btn btn-outline-secondary">ğŸ“¤ ã‚·ã‚§ã‚¢</button>
        </div>
        <p class="text-muted mb-3">${content.description}</p>
        <div class="border-top pt-3">
          <div><strong>ä½æ‰€:</strong> ${content.address}</div>
          <div><strong>é›»è©±ç•ªå·:</strong> ${content.phone}</div>
        </div>
      `;
      detailsPanel.classList.add('active');
    }

    // è©³ç´°ãƒ‘ãƒãƒ«éè¡¨ç¤º
    function hideDetails() {
      document.getElementById('details-panel')
        .classList.remove('active');
    }

    // åœ°å›³ã‚¯ãƒªãƒƒã‚¯æ™‚ã«è©³ç´°ãƒ‘ãƒãƒ«ã‚’é–‰ã˜ã‚‹
    map.on('click', hideDetails);

    // ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ç¾åœ¨ä½ç½®ãƒãƒ¼ã‚«ãƒ¼ã¨å‘ãç®¡ç†
    let userMarker = null;
    let currentHeading = 0;

    function createUserMarkerHTML(heading) {
      return `
        <div class="user-marker" style="position: relative; width: 40px; height: 40px;">
          <div class="direction-wedge" style="
            position: absolute;
            top: -20px;
            left: -20px;
            width: 80px;
            height: 80px;
            background: radial-gradient(circle at 50% 50%, rgba(0, 122, 255, 0.4) 0%, rgba(0, 122, 255, 0) 80%);
            clip-path: polygon(50% 50%, 25% 0%, 75% 0%);
            transform: rotate(${heading}deg);
            transform-origin: 40px 40px;
            z-index: 1;
          "></div>
          <div style="
            position: absolute;
            top: 0;
            left: 0;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: rgba(0, 122, 255, 0.2);
            border: 2px solid rgba(0, 122, 255, 0.3);
            z-index: 2;
          "></div>
          <div style="
            position: absolute;
            top: 8px;
            left: 8px;
            width: 24px;
            height: 24px;
            background: #007AFF;
            border: 2px solid #fff;
            border-radius: 50%;
            z-index: 3;
          "></div>
        </div>
      `;
    }

    function updateUserMarker(lat, lng, heading) {
      if (!userMarker) {
        const userIcon = L.divIcon({
          html: createUserMarkerHTML(heading),
          iconSize: [40, 40],
          iconAnchor: [20, 20],
          className: ''
        });
        userMarker = L.marker([lat, lng], { icon: userIcon }).addTo(map);
      } else {
        userMarker.setLatLng([lat, lng]);
        const markerEl = userMarker.getElement();
        if (markerEl) {
          const wedge = markerEl.querySelector('.direction-wedge');
          if (wedge) {
            wedge.style.transform = `rotate(${heading}deg)`;
          }
        }
      }
    }

    if (navigator.geolocation) {
      navigator.geolocation.watchPosition(
        (position) => {
          const lat = position.coords.latitude;
          const lng = position.coords.longitude;
          let heading = position.coords.heading;
          if (heading === null || isNaN(heading)) {
            heading = currentHeading;
          }
          updateUserMarker(lat, lng, heading);
        },
        (error) => {
          console.error("Geolocation error code:", error.code, "message:", error.message);
        },
        { enableHighAccuracy: true, maximumAge: 30000, timeout: 27000 }
      );
    } else {
      alert("ã“ã®ãƒ–ãƒ©ã‚¦ã‚¶ã¯ Geolocation API ã«å¯¾å¿œã—ã¦ã„ã¾ã›ã‚“ã€‚");
    }

    if (window.DeviceOrientationEvent) {
      window.addEventListener(
        "deviceorientation",
        (event) => {
          if (event.alpha !== null) {
            currentHeading = event.alpha;
          }
        },
        true
      );
    }
  </script>
  </body>

</html>
