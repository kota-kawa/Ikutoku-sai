<!-- templates/layout.html -->
<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>{% block title %}幾徳祭{% endblock %}</title>

    <!-- favicon -->
    <link rel="icon" href="{{ url_for('static', filename='favicon.ico') }}"
      type="image/x-icon">
    <link rel="icon" type="image/png"
      href="{{ url_for('static', filename='favicon.png') }}">
    <link rel="shortcut icon"
      href="{{ url_for('static', filename='favicon.ico') }}">

    <!-- ============ External Libraries ============ -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
      rel="stylesheet">
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css"
      rel="stylesheet">
    <link
      href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;700&display=swap"
      rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/aos@2.3.4/dist/aos.css"
      rel="stylesheet" />

    <style>
    /* ============ Base ============ */
    :root {
      --kait-green: #32CD32;
      --kait-purple: #8A2BE2;
      --dark-overlay: rgba(0,0,0,0.6);
    }
    html {
      scroll-behavior: smooth;
    }
    body {
      font-family: 'Noto Sans JP', sans-serif;
      background: linear-gradient(120deg, #f8f9fa 0%, #eef2f7 50%, #e3e8f0 100%);
      color: #343a40;
      overflow-x: hidden;
    }

    /* ============ Navbar ============ */
    .navbar {
      backdrop-filter: blur(16px) saturate(180%);
      background-color: var(--dark-overlay) !important;
      transition: background 0.3s ease;
    }
    .navbar.scrolled {
      background-color: rgba(0,0,0,0.85) !important;
    }

  
    /* Footer */
    footer {
      background: #212529;
      color: #adb5bd;
      padding: 1rem 0;
    }
    </style>

    {% block head_extra %}{% endblock %}

    <!-- Google Analytics -->
    <script async
      src="https://www.googletagmanager.com/gtag/js?id=G-4TPL68169Q"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'G-4TPL68169Q');
    </script>

  </head>

  <body>
    <!-- ============ Navbar ============ -->
    <nav class="navbar navbar-expand-lg navbar-dark fixed-top">
      <div class="container">
        <a class="navbar-brand d-flex align-items-center fw-bold" href="/">
          <img
            src="{{ url_for('static', filename='favicon.png') }}"
            alt="幾徳祭ロゴ"
            style="width:1.5rem; height:1.5rem;">
          <span style="margin-left:0.75rem;">幾徳祭</span>
        </a>
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse"
          data-bs-target="#navMenu">
          <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navMenu">
          <ul class="navbar-nav ms-auto">
            <li class="nav-item"><a class="nav-link"
                href="{{ url_for('about') }}">概要</a></li>
            <li class="nav-item"><a class="nav-link"
                href="{{ url_for('announce') }}">ご案内</a></li>
            <li class="nav-item"><a class="nav-link"
                href="{{ url_for('event') }}">企画一覧</a></li>
            <li class="nav-item"><a class="nav-link"
                href="{{ url_for('map') }}">MAP</a></li>
          </ul>
        </div>
      </div>
    </nav>

    <!-- ページ固有コンテンツ -->
    <main class="pt-4">
      {% block content %}{% endblock %}
    </main>

    <!-- ============ Footer ============ -->
    <footer class="text-center">
      <div class="container">
        <small>
          © 2025 神奈川工科大学学友会イベント局
          <!-- ビンゴへのリンクを追加 -->
          &nbsp;|&nbsp;
          <a href="/bingo" class="text-decoration-none text-light">
            ビンゴ(運営用)
          </a>
        </small>
      </div>
    </footer>

    <!-- ============ Scripts ============ -->
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/aos@2.3.4/dist/aos.js"></script>
    <script>
      // Navbar background change on scroll
      const navbar = document.querySelector('.navbar');
      window.addEventListener('scroll', () => {
        if (window.scrollY > 60) navbar.classList.add('scrolled');
        else navbar.classList.remove('scrolled');
      });
      // Init AOS animations
      AOS.init({ once: true, offset: 120, duration: 700 });


        // ドキュメント全体のクリックを監視
  document.addEventListener('click', function(event) {
    const navMenu = document.getElementById('navMenu');
    const toggler = document.querySelector('.navbar-toggler');
    // メニューが開いていて、クリック先がメニュー内部でもハンバーガーボタンでもない場合
    if (
      navMenu.classList.contains('show') &&
      !navMenu.contains(event.target) &&
      !toggler.contains(event.target)
    ) {
      // Collapse インスタンスを取得して閉じる
      bootstrap.Collapse.getInstance(navMenu)?.hide()
      || new bootstrap.Collapse(navMenu, { toggle: false }).hide();
    }
  });
  
    </script>

    {% block scripts_extra %}{% endblock %}
  </body>
</html>
